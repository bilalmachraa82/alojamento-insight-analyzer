# Performance Optimization Quick Start Guide
## 30-Day Sprint to Better Core Web Vitals

**Goal:** Achieve 90+ Lighthouse score and pass Core Web Vitals in 30 days

---

## Week 1: Font & Critical Resource Optimization (HIGH IMPACT)

### Day 1-2: Self-Host Fonts

**Current Problem:** 3 separate font requests to Google Fonts CDN (~399KB total)

**Solution:**
```bash
# Install tools
npm install -g glyphhanger

# Download and subset fonts (or use google-webfonts-helper.herokuapp.com)
glyphhanger --subset="*.woff2" --formats=woff2 --US_ASCII --whitelist="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"
```

**Create `/public/fonts/` directory:**
- `inter-var-latin.woff2` (~20KB)
- `montserrat-var-latin.woff2` (~22KB)
- `playfair-var-latin.woff2` (~12KB)

**Update `index.html`:**
```html
<head>
  <!-- REMOVE Google Fonts link -->
  <!-- <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Montserrat:wght@400;500;600;700;800&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet"> -->

  <!-- ADD Preload directives -->
  <link rel="preload" href="/fonts/inter-var-latin.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="/fonts/montserrat-var-latin.woff2" as="font" type="font/woff2" crossorigin>
</head>
```

**Create `src/fonts.css`:**
```css
@font-face {
  font-family: 'Inter Variable';
  src: url('/fonts/inter-var-latin.woff2') format('woff2-variations');
  font-weight: 300 700;
  font-display: swap;
  font-style: normal;
}

@font-face {
  font-family: 'Montserrat Variable';
  src: url('/fonts/montserrat-var-latin.woff2') format('woff2-variations');
  font-weight: 300 800;
  font-display: swap;
}

@font-face {
  font-family: 'Playfair Display Variable';
  src: url('/fonts/playfair-var-latin.woff2') format('woff2-variations');
  font-weight: 400 700;
  font-display: swap;
}
```

**Update `src/index.css`:**
```css
/* REMOVE @import url(...) */
/* @import url('https://fonts.googleapis.com/css2?family=Inter...'); */

/* ADD local import at top */
@import './fonts.css';
```

**Expected Result:**
- ðŸŽ¯ LCP improvement: -0.5 to -1.0 seconds
- ðŸŽ¯ Font file size: 399KB â†’ 54KB (86% reduction)

---

### Day 3-4: Add Resource Hints

**Update `index.html`:**
```html
<head>
  <!-- Preconnect to Supabase -->
  <link rel="dns-prefetch" href="https://YOUR_SUPABASE_URL.supabase.co">
  <link rel="preconnect" href="https://YOUR_SUPABASE_URL.supabase.co">

  <!-- Preload critical CSS (generated by Vite) -->
  <link rel="preload" href="/assets/index.css" as="style">

  <!-- Fonts already added above -->
</head>
```

**Expected Result:**
- ðŸŽ¯ TTFB improvement: -200ms to -400ms for API calls
- ðŸŽ¯ Earlier resource discovery

---

### Day 5: Implement Basic Lazy Loading

**Create `src/components/LazyImage.tsx`:**
```typescript
interface LazyImageProps {
  src: string;
  alt: string;
  className?: string;
  priority?: boolean;
}

export function LazyImage({ src, alt, className, priority = false }: LazyImageProps) {
  return (
    <img
      src={src}
      alt={alt}
      className={className}
      loading={priority ? 'eager' : 'lazy'}
      decoding={priority ? 'sync' : 'async'}
    />
  );
}
```

**Update image usage across app:**
```tsx
// Before
<img src="/images/hero.jpg" alt="Hero" />

// After
<LazyImage src="/images/hero.jpg" alt="Hero" priority={true} />
<LazyImage src="/images/feature.jpg" alt="Feature" />
```

**Expected Result:**
- ðŸŽ¯ Initial page load: -40-50% fewer image requests
- ðŸŽ¯ LCP improvement if hero image is prioritized

---

## Week 2: Bundle Optimization (MEDIUM-HIGH IMPACT)

### Day 6-7: Install Performance Plugins

```bash
npm install -D vite-plugin-compression vite-plugin-pwa
```

**Update `vite.config.ts`:**
```typescript
import viteCompression from 'vite-plugin-compression';
import { VitePWA } from 'vite-plugin-pwa';

export default defineConfig({
  plugins: [
    react(),

    // Brotli compression
    viteCompression({
      algorithm: 'brotliCompress',
      ext: '.br',
      threshold: 1024,
    }),

    // Gzip fallback
    viteCompression({
      algorithm: 'gzip',
      ext: '.gz',
      threshold: 1024,
    }),

    // PWA with service worker
    VitePWA({
      registerType: 'autoUpdate',
      workbox: {
        runtimeCaching: [
          {
            urlPattern: /\.(?:png|jpg|jpeg|svg|webp)$/,
            handler: 'CacheFirst',
            options: {
              cacheName: 'images',
              expiration: {
                maxEntries: 100,
                maxAgeSeconds: 60 * 60 * 24 * 30, // 30 days
              },
            },
          },
        ],
      },
    }),
  ],
});
```

**Expected Result:**
- ðŸŽ¯ Bundle size reduction: 15-25% with Brotli
- ðŸŽ¯ Offline image caching

---

### Day 8-9: Route-based Code Splitting

**Update `src/App.tsx`:**
```typescript
import { lazy, Suspense } from 'react';
import { LoadingSpinner } from '@/components/ui/loading-spinner';

// Lazy load heavy routes
const Dashboard = lazy(() => import('./pages/Dashboard'));
const DiagnosticForm = lazy(() => import('./pages/DiagnosticForm'));
const ReportView = lazy(() => import('./pages/ReportView'));

function App() {
  return (
    <Suspense fallback={<LoadingSpinner />}>
      <Routes>
        <Route path="/" element={<HomePage />} /> {/* Not lazy - immediate */}
        <Route path="/dashboard" element={<Dashboard />} />
        <Route path="/diagnostic" element={<DiagnosticForm />} />
        <Route path="/report" element={<ReportView />} />
      </Routes>
    </Suspense>
  );
}
```

**Expected Result:**
- ðŸŽ¯ Initial bundle: -30-50% smaller
- ðŸŽ¯ Time to Interactive: -1-2 seconds

---

### Day 10: Enhanced Terser Configuration

**Update `vite.config.ts` build section:**
```typescript
build: {
  minify: 'terser',
  terserOptions: {
    compress: {
      drop_console: true,
      drop_debugger: true,
      passes: 3, // More aggressive (was 2)
      pure_funcs: ['console.log', 'console.info', 'console.debug', 'console.trace'],
      ecma: 2020,
      module: true,
    },
    mangle: {
      safari10: false,
      toplevel: true,
    },
  },
},
```

**Expected Result:**
- ðŸŽ¯ Additional 5-10% bundle size reduction

---

## Week 3: Image Optimization (HIGH IMPACT)

### Day 11-13: Convert Images to WebP

**Option A: Manual Conversion (Free)**
```bash
# Install cwebp
brew install webp  # Mac
# or
sudo apt-get install webp  # Linux

# Convert images
for img in public/images/*.{jpg,png}; do
  cwebp -q 80 "$img" -o "${img%.*}.webp"
done
```

**Option B: Use Cloudflare Images (Paid, Automatic)**
```typescript
// src/lib/cloudflare-images.ts
const CF_ACCOUNT_HASH = 'YOUR_ACCOUNT_HASH';

export function getCFImageUrl(imageId: string, width?: number) {
  const baseUrl = `https://imagedelivery.net/${CF_ACCOUNT_HASH}/${imageId}/public`;
  if (width) {
    return `${baseUrl}?width=${width}&format=auto`;
  }
  return baseUrl;
}
```

**Create `src/components/OptimizedImage.tsx`:**
```typescript
export function OptimizedImage({ src, alt, width, height, priority = false }) {
  const webpSrc = src.replace(/\.(jpg|jpeg|png)$/, '.webp');

  return (
    <picture>
      <source type="image/webp" srcSet={webpSrc} />
      <img
        src={src}
        alt={alt}
        width={width}
        height={height}
        loading={priority ? 'eager' : 'lazy'}
        decoding={priority ? 'sync' : 'async'}
      />
    </picture>
  );
}
```

**Expected Result:**
- ðŸŽ¯ Image size reduction: 25-35% (WebP) to 50% (AVIF)
- ðŸŽ¯ Page weight reduction: 40-60%

---

### Day 14-15: Responsive Images

**Update `OptimizedImage.tsx`:**
```typescript
export function OptimizedImage({ src, alt, width, height, priority = false }) {
  const srcSet = `
    ${src}?w=400 400w,
    ${src}?w=800 800w,
    ${src}?w=1200 1200w,
    ${src}?w=1920 1920w
  `;

  return (
    <img
      src={`${src}?w=1200`}
      srcSet={srcSet}
      sizes="(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 33vw"
      alt={alt}
      width={width}
      height={height}
      loading={priority ? 'eager' : 'lazy'}
    />
  );
}
```

**Expected Result:**
- ðŸŽ¯ Mobile users get smaller images (60-70% savings)
- ðŸŽ¯ Faster mobile load times

---

## Week 4: Monitoring & Measurement (CRITICAL)

### Day 16-18: Install Web Vitals Monitoring

```bash
npm install web-vitals
```

**Create `src/lib/performance-monitoring.ts`:**
```typescript
import { onCLS, onFCP, onINP, onLCP, onTTFB } from 'web-vitals';

function sendToAnalytics(metric: any) {
  // Send to Google Analytics
  if (window.gtag) {
    window.gtag('event', metric.name, {
      value: Math.round(metric.value),
      metric_rating: metric.rating,
    });
  }

  // Send to console in development
  if (import.meta.env.DEV) {
    console.log(metric.name, metric.value, metric.rating);
  }
}

export function initPerformanceMonitoring() {
  onCLS(sendToAnalytics);
  onFCP(sendToAnalytics);
  onINP(sendToAnalytics);
  onLCP(sendToAnalytics);
  onTTFB(sendToAnalytics);
}
```

**Update `src/main.tsx`:**
```typescript
import { initPerformanceMonitoring } from './lib/performance-monitoring';

// ... existing code ...

initPerformanceMonitoring();
```

**Expected Result:**
- ðŸŽ¯ Real-time performance data
- ðŸŽ¯ Identify issues in production

---

### Day 19-20: Setup Lighthouse CI

```bash
npm install -D @lhci/cli
```

**Create `lighthouserc.json`:**
```json
{
  "ci": {
    "collect": {
      "numberOfRuns": 3,
      "startServerCommand": "npm run preview",
      "url": ["http://localhost:4173/"]
    },
    "assert": {
      "assertions": {
        "categories:performance": ["error", { "minScore": 0.9 }],
        "largest-contentful-paint": ["error", { "maxNumericValue": 2500 }],
        "cumulative-layout-shift": ["error", { "maxNumericValue": 0.1 }]
      }
    }
  }
}
```

**Create `.github/workflows/lighthouse.yml`:**
```yaml
name: Lighthouse CI
on: [pull_request]

jobs:
  lighthouse:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
      - run: npm ci
      - run: npm run build
      - run: npx @lhci/cli autorun
```

**Expected Result:**
- ðŸŽ¯ Automated performance testing on every PR
- ðŸŽ¯ Prevent performance regressions

---

### Day 21-22: Performance Budgets

```bash
npm install -D size-limit @size-limit/preset-app
```

**Update `package.json`:**
```json
{
  "size-limit": [
    {
      "path": "dist/assets/index-*.js",
      "limit": "280 KB"
    },
    {
      "path": "dist/assets/*.css",
      "limit": "15 KB"
    }
  ],
  "scripts": {
    "size": "size-limit"
  }
}
```

**Add to CI:**
```yaml
# .github/workflows/size-limit.yml
name: Size Limit
on: [pull_request]
jobs:
  size:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - run: npm ci
      - run: npm run build
      - run: npm run size
```

**Expected Result:**
- ðŸŽ¯ Automatic bundle size checks
- ðŸŽ¯ Fail builds if bundles are too large

---

### Day 23-25: Optimize Event Handlers

**Create `src/utils/performance.ts`:**
```typescript
import { useCallback, useRef } from 'react';

export function useDebouncedCallback<T extends (...args: any[]) => any>(
  callback: T,
  delay: number
) {
  const timeoutRef = useRef<NodeJS.Timeout>();

  return useCallback(
    (...args: Parameters<T>) => {
      if (timeoutRef.current) {
        clearTimeout(timeoutRef.current);
      }
      timeoutRef.current = setTimeout(() => callback(...args), delay);
    },
    [callback, delay]
  );
}

export function useThrottledCallback<T extends (...args: any[]) => any>(
  callback: T,
  delay: number
) {
  const lastRunRef = useRef(Date.now());

  return useCallback(
    (...args: Parameters<T>) => {
      if (Date.now() - lastRunRef.current >= delay) {
        callback(...args);
        lastRunRef.current = Date.now();
      }
    },
    [callback, delay]
  );
}
```

**Use in search components:**
```typescript
const debouncedSearch = useDebouncedCallback((value: string) => {
  performSearch(value);
}, 300);

<input onChange={(e) => debouncedSearch(e.target.value)} />
```

**Expected Result:**
- ðŸŽ¯ INP improvement: 30-50%
- ðŸŽ¯ Smoother user interactions

---

### Day 26-28: Fix Layout Shifts

**Reserve space for images:**
```tsx
// Always specify width and height
<img
  src="/hero.webp"
  width={1200}
  height={675}
  alt="Hero"
  className="w-full h-auto"
/>
```

**Add aspect ratio containers:**
```css
/* src/index.css */
.aspect-video {
  aspect-ratio: 16 / 9;
}

.aspect-square {
  aspect-ratio: 1 / 1;
}
```

**Use skeleton loaders:**
```tsx
import { Skeleton } from '@/components/ui/skeleton';

function Dashboard() {
  const { data, isLoading } = useQuery('dashboard');

  if (isLoading) {
    return (
      <div className="space-y-4">
        <Skeleton className="h-48 w-full" />
        <Skeleton className="h-24 w-full" />
      </div>
    );
  }

  return <DashboardContent data={data} />;
}
```

**Expected Result:**
- ðŸŽ¯ CLS < 0.1 (target met)
- ðŸŽ¯ Zero visible layout shifts

---

### Day 29-30: Testing & Validation

**Local Testing:**
```bash
# Build
npm run build

# Preview
npm run preview

# Test Lighthouse
npx lighthouse http://localhost:4173 --view

# Check sizes
npm run size
```

**Production Testing:**
```bash
# Deploy to staging
vercel --prod

# Run WebPageTest
# https://www.webpagetest.org/
# Test from multiple locations

# Monitor in production
# Check RUM data in Google Analytics
```

**Expected Result:**
- ðŸŽ¯ Lighthouse Score: 90+
- ðŸŽ¯ Core Web Vitals: All "Good"
- ðŸŽ¯ Ready for production deployment

---

## Checklist

### Week 1
- [ ] Download and subset fonts to WOFF2
- [ ] Create `/public/fonts/` directory
- [ ] Add font preload directives to `index.html`
- [ ] Create `src/fonts.css` with @font-face rules
- [ ] Remove Google Fonts import from `index.css`
- [ ] Add resource hints (preconnect, dns-prefetch)
- [ ] Create `LazyImage` component
- [ ] Update images to use lazy loading

### Week 2
- [ ] Install `vite-plugin-compression` and `vite-plugin-pwa`
- [ ] Configure Brotli compression in Vite
- [ ] Setup service worker with PWA plugin
- [ ] Implement route-based code splitting
- [ ] Wrap routes with `<Suspense>` and lazy imports
- [ ] Enhance Terser minification settings
- [ ] Test bundle sizes

### Week 3
- [ ] Convert images to WebP (or setup Cloudflare Images)
- [ ] Create `OptimizedImage` component with `<picture>` element
- [ ] Add responsive images with srcset
- [ ] Replace all `<img>` tags with `<OptimizedImage>`
- [ ] Test image loading on different devices
- [ ] Verify image size reductions

### Week 4
- [ ] Install `web-vitals` package
- [ ] Create `performance-monitoring.ts`
- [ ] Initialize performance monitoring in `main.tsx`
- [ ] Setup Lighthouse CI with GitHub Actions
- [ ] Configure `lighthouserc.json`
- [ ] Install and configure `size-limit`
- [ ] Create debounce/throttle utility hooks
- [ ] Fix layout shifts (add dimensions, skeletons)
- [ ] Run full testing suite
- [ ] Deploy to staging and validate

---

## Expected Results After 30 Days

| Metric | Before | After | Improvement |
|--------|--------|-------|-------------|
| **LCP** | ~4.0s | ~2.2s | **45%** âœ… |
| **INP** | ~350ms | ~180ms | **48%** âœ… |
| **CLS** | ~0.15 | ~0.06 | **60%** âœ… |
| **Lighthouse** | 70 | 92 | **31%** âœ… |
| **Bundle Size** | 850 KB | 500 KB | **41%** âœ… |
| **Page Load** | 4.2s | 1.8s | **57%** âœ… |

---

## Troubleshooting

### Fonts Not Loading
```bash
# Check font files exist
ls -lh public/fonts/

# Verify MIME types in network tab
# Should be: font/woff2

# Check CORS headers if using CDN
```

### Service Worker Issues
```bash
# Clear service worker
# Chrome DevTools -> Application -> Service Workers -> Unregister

# Clear cache
# Application -> Cache Storage -> Delete all
```

### Large Bundle Size
```bash
# Analyze bundle
npm run build:analyze

# Check for duplicate dependencies
npx depcheck

# Use ES module versions
# lodash -> lodash-es
```

### Poor Lighthouse Score
```bash
# Test in incognito mode
# Disable browser extensions
# Use DevTools device emulation
# Test on real mobile device
```

---

## Next Steps (After Day 30)

### Month 2: Advanced Optimizations
- [ ] Implement critical CSS extraction
- [ ] Add Web Workers for heavy computations
- [ ] Setup AVIF images (in addition to WebP)
- [ ] Implement blur-up image loading
- [ ] Add prefetching for future routes

### Month 3: Advanced Monitoring
- [ ] Setup DebugBear or SpeedCurve (RUM)
- [ ] Create custom performance dashboard
- [ ] Setup automated alerts
- [ ] Conduct competitor benchmarking
- [ ] Document performance guidelines for team

---

## Resources

**Tools:**
- [Google Fonts Helper](https://google-webfonts-helper.herokuapp.com/) - Download & subset fonts
- [Squoosh](https://squoosh.app/) - Image optimization
- [WebPageTest](https://www.webpagetest.org/) - Performance testing
- [Lighthouse](https://developers.google.com/web/tools/lighthouse) - Auditing

**Documentation:**
- [Web Vitals](https://web.dev/vitals/)
- [Vite Performance](https://vitejs.dev/guide/performance.html)
- [Workbox](https://developers.google.com/web/tools/workbox)

**Browser Extensions:**
- Web Vitals (Chrome)
- Lighthouse (Chrome)
- React DevTools (Chrome/Firefox)

---

## Support

If you encounter issues:
1. Check browser console for errors
2. Review network tab for failed requests
3. Use Lighthouse to identify specific issues
4. Test in different browsers/devices
5. Compare before/after metrics

**Remember:** Performance optimization is iterative. Monitor, measure, and continuously improve!

---

**Last Updated:** 2025-11-08
**Estimated Time:** 30 days (with 1-2 developers)
**Difficulty:** Medium
**Impact:** HIGH - Expect 40-65% performance improvement
